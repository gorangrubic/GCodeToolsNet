<!DOCTYPE html>
<html lang="en">

<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <title>GCode</title>
    <meta charset="utf-8">
    <style>
        #3dviewer,
        #3dviewer-renderArea {
            position: relative;
            width: 800px;
            height: 600px;
            margin: auto;
            background-color: rgb(0, 255, 128);
        }
    </style>
</head>

<body>
    <div id="3dviewer">
        <div class="3dviewer-units-indicator">-</div>
        <div class="frames-per-sec">32&nbsp;fps</div>

        <!-- WebGL rendering area -->
        <div id="3dviewer-renderArea">
            <div class="youhavenowebgl hidden" style="width:100%;height:100%;color:white;position:absolute;top:0;left:0;">
                You appear to not have WebGL support or WebGL has crashed. The 3D Viewer can't be used without WebGL.</div>
            <div class="data-details hidden">Drag and Drop Gcode Here...</div>
        </div>
    </div>

    <script src="js/three.js"></script>
    <script src="js/Tween.js"></script>
    <script src="js/OrbitControls.js"></script>
    <script src="js/TrackballControls.js"></script>

    <!-- Custom code -->
    <script src="gcode-parser.js"></script>
    <script src="gcode-model.js"></script>
    <script src="renderer.js"></script>
    <script src="ui.js"></script>

    <script>
        var scene = null;
        var object = null;
        var camera = null;
        var controls = null;
        var element = null;
        var toolhead = null;
        var shadowplane = null;
        var tween = null;
        var tweenHighlight = null;
        var tweenIndex = null;
        var tweenSpeed = 1;
        var tweenPaused = false;
        var tweenIsPlaying = false;
        var wantAnimate = true; // we automatically timeout rendering to save on cpu

        var axes = null; // global property to store axes that we drew
        var grid = null; // stores grid
        var gridSize = 1; // global property for size of grid. default to 1 (shapeoko rough size)
        var decorate = null; // stores the decoration 3d objects
        var bboxHelper = null;
        var font = undefined;
        var showShadow = false;
        var arrowHelper = null;

        var mytimeout = null;
        var renderFrameCtr = 0; // keep track of fps
        var fpsCounterInterval = null;
        var fpsEl = null;
        var animEnable = true; // boolean tracking whether we allow animation

        // 200 = 5fps, 100 = 10fps, 70=15fps, 50=20fps, 40=25fps, 30=30fps
        frameRateDelayMs = 32;
        isNoSleepMode = false;

        init();

        function init() {
            element = document.getElementById('3dviewer-renderArea');
            scene = createScene(element);

            var lastImported = localStorage.getItem('last-imported');
            var lastLoaded = localStorage.getItem('last-loaded');
            if (lastImported) {
                openGCodeFromText(lastImported);
            } else {
                // console.log("loading chilipeppr logo");
                // openGCodeFromPath(lastLoaded || 'https://www.chilipeppr.com/3d/chilipepprlogo.nc');
                openGCodeFromPath('gcode/octocat.gcode');                
            }
        }    
    </script>

</body>

</html>